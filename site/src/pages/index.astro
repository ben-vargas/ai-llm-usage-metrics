---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';

// Fetch npm version at build time for fallback
let npmVersion = '';
try {
  const response = await fetch('https://registry.npmjs.org/llm-usage-metrics/latest');
  const data = await response.json();
  npmVersion = data.version || '';
} catch {
  // Build-time fetch failed, will use runtime fetch or fallback
}
---

<StarlightPage frontmatter={{ title: 'llm-usage-metrics', template: 'splash' }}>
  <div class="grain-overlay" aria-hidden="true"></div>
  
  <!-- Hero Section -->
  <section class="hero-split" aria-labelledby="hero-title">
    <div class="hero-content">
      <div class="badge" id="version-badge" data-build-version={npmVersion}>
        <span class="status-dot" aria-hidden="true"></span>
        <span class="badge-text">{npmVersion ? `v${npmVersion} on npm` : 'available on npm'}</span>
      </div>

      <h1 id="hero-title">
        Quantify your local<br />
        <em>inference</em> pipeline.
      </h1>

      <p class="lead">
        Deterministic parsing for your coding agent sessions. Aggregate token usage, apply
        LiteLLM pricing models, and generate actionable reports natively from <code>.pi</code>,
        <code>.codex</code>, and OpenCode workflows.
      </p>

      <div 
        class="install-command" 
        role="button" 
        tabindex="0" 
        aria-label="Copy install command"
      >
        <div class="install-inner">
          <span class="dollar" aria-hidden="true">$</span>
          <span class="cmd">npm install -g llm-usage-metrics</span>
        </div>
        <div class="install-action" aria-hidden="true">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
        </div>
        <span class="install-toast" role="status" aria-live="polite" aria-atomic="true">Copied to clipboard</span>
      </div>

      <div class="hero-actions">
        <a href="./getting-started" class="btn btn-primary">Get Started</a>
        <a href="https://github.com/ayagmar/llm-usage-metrics" class="btn btn-secondary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 .5C5.37.5 0 5.78 0 12.29c0 5.21 3.44 9.63 8.21 11.19.6.11.82-.25.82-.57 0-.28-.01-1.02-.02-2-3.34.71-4.04-1.58-4.04-1.58-.55-1.36-1.33-1.72-1.33-1.72-1.09-.73.08-.72.08-.72 1.2.08 1.84 1.22 1.84 1.22 1.07 1.8 2.81 1.28 3.5.98.1-.76.42-1.28.76-1.58-2.67-.3-5.47-1.31-5.47-5.83 0-1.29.47-2.34 1.23-3.16-.12-.3-.53-1.5.12-3.12 0 0 1-.31 3.28 1.21A11.5 11.5 0 0 1 12 6.29c1.01.01 2.03.13 2.99.39 2.28-1.52 3.28-1.21 3.28-1.21.65 1.62.24 2.82.12 3.12.76.82 1.23 1.87 1.23 3.16 0 4.53-2.81 5.53-5.48 5.82.43.37.82 1.09.82 2.19 0 1.58-.02 2.86-.02 3.24 0 .32.22.68.82.57C20.57 21.92 24 17.5 24 12.29 24 5.78 18.63.5 12 .5z"/>
          </svg>
          GitHub
        </a>
      </div>
    </div>

    <!-- Screenshot -->
    <div class="screenshot-container">
      <img 
        src="/llm-usage-metrics/screenshot.png" 
        alt="Terminal output from llm-usage-metrics showing token usage and cost breakdown across pi, codex, and opencode sources" 
        class="screenshot" 
        loading="lazy" 
        width="1222" 
        height="946"
        tabindex="0"
        role="button"
        aria-label="View screenshot fullscreen"
      />
    </div>
  </section>

  <!-- Bento Grid Features -->
  <section class="features" aria-labelledby="features-title">
    <h2 id="features-title" class="sr-only">Features</h2>
    <div class="bento-grid">
      <div class="bento-item wide liquid-glass">
        <div class="bento-content">
          <div class="fcard-icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <circle cx="12" cy="12" r="6"/>
              <circle cx="12" cy="12" r="2"/>
            </svg>
          </div>
          <h3>Zero-Config Discovery Engine</h3>
          <p>Intelligently scans your local file system. Autonomously locates <code>.pi</code> workspaces, <code>.codex</code> log directories, and OpenCode relational databases without requiring manual configuration.</p>
        </div>
        <div class="bento-visual">
          <div class="infinite-scroll-y" aria-hidden="true">
            <div class="log-line"><span class="ti">fs.scan</span> ~/.pi/sessions/</div>
            <div class="log-line"><span class="ti">fs.scan</span> ~/.codex/history.log</div>
            <div class="log-line"><span class="ti">sqlite.connect</span> ~/.opencode/</div>
            <div class="log-line dim">... mapping inference events</div>
            <div class="log-line dim">... schema normalization complete</div>
          </div>
        </div>
      </div>

      <div class="bento-item liquid-glass">
        <div class="bento-content">
          <div class="fcard-icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
          </div>
          <h3>Dynamic Pricing Matrix</h3>
          <p>Synchronizes strictly with LiteLLM's pricing repository. Supports robust offline-mode utilizing deterministic local caching for isolated environments.</p>
        </div>
      </div>

      <div class="bento-item liquid-glass">
        <div class="bento-content">
          <div class="fcard-icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <line x1="9" y1="3" x2="9" y2="21"/>
            </svg>
          </div>
          <h3>Structured Mutators</h3>
          <p>Emit formatted <code>JSON</code> for programmatic pipeline ingestion, raw <code>Markdown</code> for documentation, or deterministic ANSI columns.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Examples Section -->
  <section class="examples" aria-labelledby="examples-title">
    <div class="section-header">
      <h2 id="examples-title">API Diagnostics</h2>
      <p class="sub">Deterministic arguments for precise reporting outputs.</p>
    </div>

    <div class="ex-container liquid-glass">
      <div class="ex-sidebar" role="tablist" aria-label="Example categories">
        <button class="ex-tab active" data-panel="ex-basics" role="tab" aria-selected="true" tabindex="0">Temporal Bounds</button>
        <button class="ex-tab" data-panel="ex-filter" role="tab" aria-selected="false" tabindex="-1">Source Isolation</button>
        <button class="ex-tab" data-panel="ex-output" role="tab" aria-selected="false" tabindex="-1">Output Targets</button>
        <button class="ex-tab" data-panel="ex-config" role="tab" aria-selected="false" tabindex="-1">Configuration</button>
      </div>
      <div class="ex-content">
        <div id="ex-basics" class="ex-panel active" role="tabpanel">
          <pre class="ex-block"><span class="cmt"># Evaluate standard rolling daily window</span>
$ llm-usage <span class="flag">daily</span>

<span class="cmt"># Evaluate trailing week, enforcing localization bounds</span>
$ llm-usage <span class="flag">weekly</span> --timezone <span class="val">Europe/Paris</span>

<span class="cmt"># Strict arbitrary bounded period</span>
$ llm-usage <span class="flag">monthly</span> --since <span class="val">2026-01-01</span> --until <span class="val">2026-01-31</span></pre>
        </div>
        <div id="ex-filter" class="ex-panel" role="tabpanel" hidden>
          <pre class="ex-block"><span class="cmt"># Isolate telemetry strictly to selected engines</span>
$ llm-usage <span class="flag">monthly</span> --source <span class="val">pi,codex</span>

<span class="cmt"># Filter downstream pipelines by model family string</span>
$ llm-usage <span class="flag">monthly</span> --model <span class="val">claude</span>

<span class="cmt"># Filter by upstream provider origin</span>
$ llm-usage <span class="flag">monthly</span> --provider <span class="val">openai</span></pre>
        </div>
        <div id="ex-output" class="ex-panel" role="tabpanel" hidden>
          <pre class="ex-block"><span class="cmt"># Target stdout with unformatted JSON payload</span>
$ llm-usage <span class="flag">daily</span> --json

<span class="cmt"># Target stdout with Markdown tables</span>
$ llm-usage <span class="flag">daily</span> --markdown

<span class="cmt"># Default terminal columns with ANSI formatting</span>
$ llm-usage <span class="flag">daily</span></pre>
        </div>
        <div id="ex-config" class="ex-panel" role="tabpanel" hidden>
          <pre class="ex-block"><span class="cmt"># Override default data directory path</span>
$ llm-usage <span class="flag">daily</span> --data-dir <span class="val">/custom/path</span>

<span class="cmt"># Enable verbose diagnostic output</span>
$ llm-usage <span class="flag">daily</span> --verbose

<span class="cmt"># Disable color output for piping</span>
$ llm-usage <span class="flag">daily</span> --no-color</pre>
        </div>
      </div>
    </div>
  </section>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Screenshot preview">
    <button class="lightbox-close" aria-label="Close screenshot preview">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    <div class="lightbox-scroll">
      <img 
        src="/llm-usage-metrics/screenshot.png" 
        alt="Terminal output from llm-usage-metrics showing token usage and cost breakdown" 
        class="lightbox-image"
      />
    </div>
  </div>

  <script>
    // Inline script for progressive enhancement
    const baseUrl = document.querySelector('base')?.href || '/';
    import(new URL('_astro/landing.js', baseUrl).href).catch(() => {
      console.log('Interactive features loaded statically');
    });
  </script>
</StarlightPage>

<style>
  /* Grain overlay */
  .grain-overlay {
    position: fixed;
    inset: 0;
    z-index: 50;
    pointer-events: none;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    opacity: 0.025;
    mix-blend-mode: overlay;
  }

  /* Hero section */
  .hero-split {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    padding: 2rem 1rem;
    max-width: 1200px;
    margin: 0 auto;
    align-items: center;
  }

  @media (min-width: 1024px) {
    .hero-split {
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      padding: 4rem 2rem;
    }
  }

  .hero-content {
    order: 1;
  }

  @media (min-width: 1024px) {
    .hero-content {
      order: 0;
    }
  }

  /* Badge */
  .badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 9999px;
    font-size: 0.875rem;
    color: #a1a1aa;
    margin-bottom: 1.5rem;
  }

  .badge.loading .status-dot {
    animation: pulse 1.5s ease-in-out infinite;
  }

  .status-dot {
    width: 6px;
    height: 6px;
    background: #10b981;
    border-radius: 50%;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* Typography */
  h1 {
    font-size: 2.5rem;
    font-weight: 600;
    line-height: 1.1;
    letter-spacing: -0.025em;
    margin-bottom: 1rem;
  }

  @media (min-width: 768px) {
    h1 {
      font-size: 3.5rem;
    }
  }

  h1 em {
    color: #10b981;
    font-style: normal;
  }

  .lead {
    font-size: 1.125rem;
    color: #a1a1aa;
    line-height: 1.6;
    max-width: 540px;
    margin-bottom: 2rem;
  }

  /* Install command */
  .install-command {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 0.75rem 1rem;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.75rem;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    margin-bottom: 1.5rem;
    max-width: fit-content;
  }

  .install-command:hover {
    border-color: rgba(255, 255, 255, 0.2);
    background: rgba(0, 0, 0, 0.4);
  }

  .install-command:active {
    transform: translateY(1px) scale(0.99);
  }

  .install-inner {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'Geist Mono', monospace;
    font-size: 0.875rem;
  }

  .dollar {
    color: #52525b;
  }

  .cmd {
    color: #fafafa;
  }

  .install-action {
    color: #a1a1aa;
  }

  .install-toast {
    position: absolute;
    bottom: calc(100% + 0.5rem);
    left: 50%;
    transform: translateX(-50%);
    padding: 0.5rem 1rem;
    background: #10b981;
    color: #000;
    font-size: 0.875rem;
    font-weight: 500;
    border-radius: 0.5rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    white-space: nowrap;
  }

  .install-toast.show {
    opacity: 1;
  }

  .install-toast.error {
    background: #f87171;
  }

  /* Hero actions */
  .hero-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    border-radius: 0.75rem;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .btn-primary {
    background: #10b981;
    color: #000;
  }

  .btn-primary:hover {
    background: #34d399;
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
  }

  .btn-secondary {
    background: rgba(255, 255, 255, 0.05);
    color: #fafafa;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .btn-secondary:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
  }

  .btn:active {
    transform: translateY(1px) scale(0.98);
  }

  /* Screenshot */
  .screenshot-container {
    order: 0;
  }

  @media (min-width: 1024px) {
    .screenshot-container {
      order: 1;
    }
  }

  .screenshot {
    width: 100%;
    height: auto;
    border-radius: 0.75rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    cursor: zoom-in;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .screenshot:hover {
    transform: translateY(-2px);
    box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.5);
  }

  .screenshot:focus {
    outline: 2px solid rgba(16, 185, 129, 0.5);
    outline-offset: 4px;
  }

  /* Features section */
  .features {
    padding: 4rem 1rem;
    max-width: 1200px;
    margin: 0 auto;
  }

  @media (min-width: 768px) {
    .features {
      padding: 6rem 2rem;
    }
  }

  .bento-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .bento-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .bento-grid {
      grid-template-columns: 2fr 1fr 1fr;
    }
  }

  .bento-item {
    padding: 1.5rem;
    border-radius: 1rem;
    display: flex;
    flex-direction: column;
  }

  @media (min-width: 768px) {
    .bento-item {
      padding: 2rem;
    }
  }

  .bento-item.wide {
    grid-column: 1 / -1;
  }

  @media (min-width: 1024px) {
    .bento-item.wide {
      grid-column: 1 / 2;
      grid-row: 1 / 3;
    }
  }

  .fcard-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.2);
    border-radius: 0.75rem;
    color: #10b981;
    margin-bottom: 1rem;
  }

  .bento-content h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .bento-content p {
    color: #a1a1aa;
    font-size: 0.9375rem;
    line-height: 1.6;
  }

  .bento-content code {
    color: #fafafa;
    font-family: 'Geist Mono', monospace;
    font-size: 0.875em;
  }

  .bento-visual {
    margin-top: auto;
    padding-top: 1.5rem;
  }

  .infinite-scroll-y {
    font-family: 'Geist Mono', monospace;
    font-size: 0.75rem;
    color: #52525b;
  }

  .log-line {
    padding: 0.25rem 0;
  }

  .log-line.dim {
    opacity: 0.5;
  }

  .ti {
    color: #10b981;
  }

  /* Examples section */
  .examples {
    padding: 4rem 1rem;
    max-width: 1200px;
    margin: 0 auto;
  }

  @media (min-width: 768px) {
    .examples {
      padding: 6rem 2rem;
    }
  }

  .section-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .section-header h2 {
    font-size: 1.875rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .section-header .sub {
    color: #a1a1aa;
  }

  .ex-container {
    display: grid;
    grid-template-columns: 1fr;
    border-radius: 1rem;
    overflow: hidden;
  }

  @media (min-width: 768px) {
    .ex-container {
      grid-template-columns: 200px 1fr;
    }
  }

  .ex-sidebar {
    display: flex;
    flex-direction: column;
    padding: 1rem;
    gap: 0.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }

  @media (min-width: 768px) {
    .ex-sidebar {
      border-bottom: none;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
    }
  }

  .ex-tab {
    padding: 0.75rem 1rem;
    text-align: left;
    background: transparent;
    border: none;
    border-radius: 0.5rem;
    color: #a1a1aa;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .ex-tab:hover {
    background: rgba(255, 255, 255, 0.05);
    color: #fafafa;
  }

  .ex-tab.active {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
  }

  .ex-tab:focus-visible {
    outline: 2px solid rgba(16, 185, 129, 0.5);
    outline-offset: 2px;
  }

  .ex-content {
    padding: 1.5rem;
    overflow-x: auto;
  }

  .ex-panel {
    display: none;
  }

  .ex-panel.active {
    display: block;
  }

  .ex-block {
    margin: 0;
    font-family: 'Geist Mono', monospace;
    font-size: 0.875rem;
    line-height: 1.7;
    color: #fafafa;
  }

  .ex-block .cmt {
    color: #52525b;
  }

  .ex-block .flag {
    color: #38bdf8;
  }

  .ex-block .val {
    color: #fbbf24;
  }

  /* Lightbox */
  .lightbox {
    position: fixed;
    inset: 0;
    z-index: 100;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .lightbox.open {
    opacity: 1;
    pointer-events: auto;
  }

  .lightbox-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    z-index: 101;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    color: #fafafa;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .lightbox-close:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  .lightbox-close:focus-visible {
    outline: 2px solid rgba(16, 185, 129, 0.5);
    outline-offset: 2px;
  }

  .lightbox-scroll {
    flex: 1;
    overflow: auto;
    padding: 4rem 1rem;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    cursor: zoom-out;
  }

  .lightbox-image {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
  }

  /* Screen reader only */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .grain-overlay,
    .status-dot {
      display: none;
    }

    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>
